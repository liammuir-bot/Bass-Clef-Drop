<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Whack-a-Mole — Bass Clef Edition</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #4CAF50;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
      flex-direction: column;
    }
    canvas {
      background: #8BC34A;
      border: 4px solid #3E2723;
      border-radius: 12px;
      display: none;
    }
    #controls {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(62, 39, 35, 0.8);
      padding: 10px;
      border-radius: 8px;
    }
    #hud {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(62, 39, 35, 0.8);
      padding: 10px;
      border-radius: 8px;
      display: none;
    }
    #hud button {
      margin-top: 5px;
    }
    #startScreen {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: rgba(62,39,35,0.8);
      padding: 20px;
      border-radius: 12px;
    }
    #hammer {
      position: absolute;
      font-size: 48px;
      bottom: 60px;
      left: 50%;
      transform: translateX(-50%) rotate(0deg);
      transition: transform 0.2s ease;
      display: none;
    }
    .answerButtons {
      display: flex;
      justify-content: center;
      margin-top: 10px;
    }
    .answerButtons button {
      margin: 0 4px;
      padding: 10px;
      font-size: 16px;
      border-radius: 6px;
      background: #FF9800;
      border: none;
      color: #fff;
      cursor: pointer;
    }
    .answerButtons button:hover {
      background: #F57C00;
    }
    #molePic {
      position: absolute;
      bottom: 10px;
      right: 10px;
      width: 80px;
      height: auto;
    }
  </style>
</head>
<body>
  <div id="startScreen">
    <h1>Whack-a-Mole — Bass Clef Edition</h1>
    <button id="startBtn">Start Game</button>
  </div>

  <div id="controls">
    <label>Speed: 
      <select id="speedControl">
        <option value="2000">Slow</option>
        <option value="1500" selected>Medium</option>
        <option value="1000">Fast</option>
      </select>
    </label><br>
    <label>Mode:
      <select id="modeControl">
        <option value="practice">Practice Mode (names on)</option>
        <option value="game">Game Mode (names off)</option>
      </select>
    </label>
  </div>

  <div id="hud">
    Score: <span id="score">0</span> | Lives: <span id="lives">3</span><br>
    <button id="pauseBtn">Pause Game</button>
    <button id="resetBtn">Reset</button>
  </div>

  <canvas id="game" width="900" height="500"></canvas>
  <div class="answerButtons" id="answerButtons"></div>
  <div id="hammer">🔨</div>

  <img id="molePic" src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/0a/Talpa_europaea_MHNT.jpg/320px-Talpa_europaea_MHNT.jpg" alt="Mole">

  <script>
    const canvas=document.getElementById('game');
    const ctx=canvas.getContext('2d');
    const scoreEl=document.getElementById('score');
    const livesEl=document.getElementById('lives');
    const startBtn=document.getElementById('startBtn');
    const pauseBtn=document.getElementById('pauseBtn');
    const resetBtn=document.getElementById('resetBtn');
    const hud=document.getElementById('hud');
    const startScreen=document.getElementById('startScreen');
    const speedControl=document.getElementById('speedControl');
    const modeControl=document.getElementById('modeControl');
    const answerButtons=document.getElementById('answerButtons');
    const hammer=document.getElementById('hammer');

    let score=0;
    let lives=3;
    let spawnInterval=1500;
    let notes=[];
    let running=false;
    let paused=false;
    let mode="practice";
    let lastHammerTime=0;

    // Frequencies for bass clef notes (approx in Hz)
    const noteFrequencies={
      'G':98.00,
      'A':110.00,
      'B':123.47,
      'C':130.81,
      'D':146.83,
      'E':164.81,
      'F':174.61
    };

    // Proper bass clef positions
    const staffY=300;
    const spacing=20;
    const bassNotes=[
      {name:'G',y:staffY},
      {name:'A',y:staffY-spacing/2},
      {name:'B',y:staffY-spacing},
      {name:'C',y:staffY-spacing*1.5},
      {name:'D',y:staffY-spacing*2},
      {name:'E',y:staffY-spacing*2.5},
      {name:'F',y:staffY-spacing*3},
      {name:'G',y:staffY-spacing*3.5},
      {name:'A',y:staffY-spacing*4}
    ];

    function spawnNote(){
      if(paused) return;
      const note=bassNotes[Math.floor(Math.random()*bassNotes.length)];
      notes.push({note:note.name,y:note.y,visible:true,timer:setTimeout(()=>{missNote(note.name);},spawnInterval-200)});
    }

    function drawStaff(){
      ctx.strokeStyle='white';
      for(let i=0;i<5;i++){
        ctx.beginPath();
        ctx.moveTo(50,staffY-(i*spacing));
        ctx.lineTo(canvas.width-50,staffY-(i*spacing));
        ctx.stroke();
      }
      ctx.font='48px serif';
      ctx.fillText('𝄢',20,staffY-2*spacing);
    }

    function drawNotes(){
      notes.forEach(n=>{
        if(n.visible){
          ctx.beginPath();
          ctx.arc(canvas.width/2,n.y,16,0,Math.PI*2); // 20% smaller radius
          ctx.fillStyle='#FFD54F';
          ctx.fill();
          ctx.stroke();
          if(mode==="practice"){
            ctx.fillStyle='black';
            ctx.fillText(n.note,canvas.width/2-5,n.y+5);
          }
        }
      });
    }

    function update(){
      if(!running) return;
      ctx.clearRect(0,0,canvas.width,canvas.height);
      drawStaff();
      drawNotes();
      requestAnimationFrame(update);
    }

    function playNoteSound(letter){
      if(!noteFrequencies[letter]) return;
      const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
      const oscillator=audioCtx.createOscillator();
      const gainNode=audioCtx.createGain();
      oscillator.type='sine';
      oscillator.frequency.value=noteFrequencies[letter];
      oscillator.connect(gainNode);
      gainNode.connect(audioCtx.destination);
      oscillator.start();
      gainNode.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+1);
      oscillator.stop(audioCtx.currentTime+1);
    }

    function whackHammer(){
      const now=Date.now();
      if(now-lastHammerTime<300) return;
      lastHammerTime=now;
      hammer.style.display='block';
      hammer.style.transform='translateX(-50%) rotate(-45deg)';
      setTimeout(()=>{hammer.style.transform='translateX(-50%) rotate(0deg)';},200);
    }

    function hitNote(letter){
      notes.forEach((n,i)=>{
        if(n.visible && n.note===letter){
          score+=10;
          scoreEl.textContent=score;
          n.visible=false;
          clearTimeout(n.timer);
          notes.splice(i,1);
          playNoteSound(letter);
          whackHammer();
        }
      });
    }

    function missNote(){
      lives--;
      livesEl.textContent=lives;
      if(lives<=0){
        running=false;
        ctx.fillStyle='red';
        ctx.font='28px sans-serif';
        ctx.fillText('Game Over! Score: '+score,canvas.width/2-100,canvas.height/2);
      }
    }

    function startGame(){
      startScreen.style.display='none';
      hud.style.display='block';
      canvas.style.display='block';
      answerButtons.style.display='flex';
      hammer.style.display='block';
      spawnInterval=parseInt(speedControl.value);
      mode=modeControl.value;
      score=0;
      lives=3;
      scoreEl.textContent=score;
      livesEl.textContent=lives;
      notes=[];
      running=true;
      setInterval(spawnNote,spawnInterval);
      update();
    }

    function togglePause(){
      paused=!paused;
      pauseBtn.textContent=paused?"Resume":"Pause Game";
    }

    function resetGame(){
      location.reload();
    }

    startBtn.addEventListener('click',startGame);
    pauseBtn.addEventListener('click',togglePause);
    resetBtn.addEventListener('click',resetGame);

    window.addEventListener('keydown',e=>{
      if(paused||!running) return;
      const key=e.key.toUpperCase();
      if(['A','B','C','D','E','F','G'].includes(key)){
        hitNote(key);
      }
    });

    ['A','B','C','D','E','F','G'].forEach(letter=>{
      const btn=document.createElement('button');
      btn.textContent=letter;
      btn.addEventListener('click',()=>{
        if(!paused&&running) hitNote(letter);
      });
      answerButtons.appendChild(btn);
    });
  </script>
</body>
</html>
